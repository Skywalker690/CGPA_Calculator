<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Calculator</title>
    <link rel="icon" href="Assets/tracking.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Original Styles with Enhanced Responsiveness */
.attendance-container {
    width: 90%;
    max-width: 1000px;
    margin: 20px auto;
    background: #1e1e1e;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.attendance-header {
    text-align: center;
    color: #ffffff;
    margin-bottom: 30px;
}

.attendance-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.attendance-table th,
.attendance-table td {
    border: 1px solid #444;
    padding: 12px;
    text-align: center;
    color: #e0e0e0;
}

.attendance-table th {
    background-color: #333;
    font-weight: bold;
}

.input-field {
    width: 100%; /* Flexible width */
    max-width: 80px;
    padding: 8px;
    background-color: #1e1e1e;
    color: #e0e0e0;
    border: 1px solid #444;
    border-radius: 4px;
    text-align: center;
    box-sizing: border-box;
}

.input-field:focus {
    outline: none;
    border-color: #007bff;
}

.target-input {
    width: 100%; /* Flexible for smaller screens */
    max-width: 60px;
}

.result-cell {
    font-weight: bold;
}

.target-achieved {
    color: #28a745;
}

.extra-needed {
    color: #ffc107;
}

.back-to-cgpa {
    display: block;
    margin: 20px auto;
    padding: 12px 24px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    text-decoration: none;
    text-align: center;
    width: auto;
    min-width: 200px; /* Touch-friendly size */
}

.back-to-cgpa:hover {
    background-color: #0056b3;
}

.global-target {
    text-align: center;
    margin: 20px 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
}

.global-target label {
    color: #e0e0e0;
    margin-right: 10px;
    font-weight: bold;
}

.error-message {
    color: #dc3545;
    font-size: 12px;
    margin-top: 5px;
    text-align: left;
}

/* Enhanced Responsive Styles - Mobile-First Approach */
@media screen and (min-width: 481px) {
    .input-field {
        max-width: 80px;
    }

    .target-input {
        max-width: 60px;
    }

    .back-to-cgpa {
        width: fit-content;
    }

    .global-target {
        flex-direction: row;
    }

    .global-target label {
        margin-bottom: 0;
    }
}

@media screen and (min-width: 769px) {
    .attendance-container {
        padding: 20px;
    }

    .attendance-header {
        font-size: 1.5em;
    }

    .attendance-table th,
    .attendance-table td {
        padding: 12px;
        font-size: 1em;
    }

    .back-to-cgpa {
        padding: 12px 24px;
    }
}

@media screen and (min-width: 1025px) {
    .attendance-container {
        width: 80%;
        max-width: 1200px;
    }
}

/* Stacked Table for Small Screens */
@media screen and (max-width: 768px) {
    .attendance-container {
        padding: 10px;
        margin: 10px;
    }

    .attendance-header {
        font-size: 1.2em;
        margin-bottom: 20px;
    }

    .attendance-table th,
    .attendance-table td {
        padding: 8px;
        font-size: 0.9em;
    }

    .global-target {
        flex-direction: column;
    }

    .global-target label {
        margin-right: 0;
        margin-bottom: 8px;
    }

    .back-to-cgpa {
        width: 100%;
        padding: 12px;
    }
}

@media screen and (max-width: 480px) {
    .attendance-container {
        padding: 8px;
    }

    .attendance-header {
        font-size: 1.1em;
    }

    .attendance-table {
        border: none;
    }

    .attendance-table thead {
        display: none;
    }

    .attendance-table tbody,
    .attendance-table tr {
        display: block;
        width: 100%;
    }

    .attendance-table tr {
        margin-bottom: 15px;
        border: 1px solid #444;
        border-radius: 4px;
        background: #2a2a2a;
    }

    .attendance-table td {
        display: flex;
        align-items: center;
        text-align: right;
        padding: 10px;
        border: none;
        border-bottom: 1px solid #444;
        position: relative;
    }

    .attendance-table td::before {
        content: attr(data-label);
        flex: 1 1 40%;
        text-align: left;
        font-weight: bold;
        color: #ffffff;
        padding-right: 10px;
        white-space: nowrap;
    }

    .attendance-table td > * {
        flex: 1 1 60%;
    }

    .attendance-table td:last-child {
        border-bottom: none;
    }

    .error-message {
        font-size: 0.8em;
        margin-left: 40%; /* Align with input */
    }
}

/* Table Wrapper for Horizontal Scrolling Fallback */
.table-wrapper {
    overflow-x: auto;
    margin-top: 20px;
    -webkit-overflow-scrolling: touch; /* Smooth iOS scrolling */
}

    </style>
</head>
<body>
    <div class="attendance-container">
        <h1 class="attendance-header">Attendance Calculator</h1>
        <p class="attendance-header" id="semester-info">Loading...</p>
        
        <div class="global-target">
            <label for="global-target-percentage">Default Target Attendance:</label>
            <input type="number" id="global-target-percentage" class="input-field target-input" value="75" min="0" max="100" onchange="updateAllTargets()">
            <span style="color: #e0e0e0;">%</span>
        </div>

        <table class="attendance-table" id="attendance-table">
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Classes Conducted</th>
                    <th>Classes Attended</th>
                    <th>Current %</th>
                    <th>Target %</th>
                    <th>Extra Classes Needed</th>
                </tr>
            </thead>
            <tbody id="attendance-tbody">
                <!-- Dynamic content will be inserted here -->
            </tbody>
        </table>

        <a href="index.html" class="back-to-cgpa">← Back to CGPA Calculator</a>
    </div>

    <footer class="footer">
        <p>Developed by <a href="https://github.com/Skywalker690" target="_blank">Skywalker690</a></p>
        <p>© 2025 CGPA Calculator. All rights reserved.</p>
    </footer>

    <script>
        // Extract URL parameters
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Initialize the page with semester data
        function initializePage() {
            const semester = getURLParameter('semester');
            const subjectsParam = getURLParameter('subjects');
            
            if (!semester || !subjectsParam) {
                document.getElementById('semester-info').textContent = 'Error: No semester data found';
                return;
            }

            document.getElementById('semester-info').textContent = `Semester ${semester} - Attendance Tracker`;
            
            try {
                const subjects = JSON.parse(decodeURIComponent(subjectsParam));
                generateAttendanceTable(subjects);
            } catch (error) {
                document.getElementById('semester-info').textContent = 'Error: Invalid subject data';
            }
        }

        // Generate the attendance table
        function generateAttendanceTable(subjects) {
            const tbody = document.getElementById('attendance-tbody');
            tbody.innerHTML = '';

            subjects.forEach((subject, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="text-align: left; font-weight: bold;">${subject}</td>
                    <td>
                        <input type="number" class="input-field conducted-input" min="0" value="0" 
                               onchange="calculateAttendance(${index})" data-row="${index}">
                        <div class="error-message" id="conducted-error-${index}"></div>
                    </td>
                    <td>
                        <input type="number" class="input-field attended-input" min="0" value="0" 
                               onchange="calculateAttendance(${index})" data-row="${index}">
                        <div class="error-message" id="attended-error-${index}"></div>
                    </td>
                    <td class="result-cell" id="current-percentage-${index}">0%</td>
                    <td>
                        <input type="number" class="input-field target-input target-percentage" min="0" max="100" value="75" 
                               onchange="calculateAttendance(${index})" data-row="${index}">%
                        <div class="error-message" id="target-error-${index}"></div>
                    </td>
                    <td class="result-cell" id="extra-classes-${index}">-</td>
                `;
                tbody.appendChild(row);
            });
        }   

        // Update all target percentages
        function updateAllTargets() {
            const globalTarget = document.getElementById('global-target-percentage').value;
            const targetInputs = document.querySelectorAll('.target-percentage');
            
            targetInputs.forEach((input, index) => {
                input.value = globalTarget;
                calculateAttendance(index);
            });
        }

        // Validate input values
        function validateInput(value, min, max, errorElementId, fieldName) {
            const errorElement = document.getElementById(errorElementId);
            
            if (value === '' || isNaN(value)) {
                errorElement.textContent = `${fieldName} must be a number`;
                return false;
            }
            
            if (value < min) {
                errorElement.textContent = `${fieldName} cannot be negative`;
                return false;
            }
            
            if (max && value > max) {
                errorElement.textContent = `${fieldName} cannot exceed ${max}`;
                return false;
            }
            
            errorElement.textContent = '';
            return true;
        }

        // Calculate attendance for a specific row
        function calculateAttendance(rowIndex) {
            const conductedInput = document.querySelector(`input.conducted-input[data-row="${rowIndex}"]`);
            const attendedInput = document.querySelector(`input.attended-input[data-row="${rowIndex}"]`);
            const targetInput = document.querySelector(`input.target-percentage[data-row="${rowIndex}"]`);
            
            const conducted = parseFloat(conductedInput.value);
            const attended = parseFloat(attendedInput.value);
            const target = parseFloat(targetInput.value);

            // Clear previous error messages
            document.getElementById(`conducted-error-${rowIndex}`).textContent = '';
            document.getElementById(`attended-error-${rowIndex}`).textContent = '';
            document.getElementById(`target-error-${rowIndex}`).textContent = '';

            // Validate inputs
            let isValid = true;

            // Validate conducted classes
            if (isNaN(conducted) || conducted < 0) {
                document.getElementById(`conducted-error-${rowIndex}`).textContent = 'Classes conducted must be a positive number';
                isValid = false;
            }

            // Validate attended classes
            if (isNaN(attended) || attended < 0) {
                document.getElementById(`attended-error-${rowIndex}`).textContent = 'Classes attended must be a positive number';
                isValid = false;
            } else if (!isNaN(conducted) && attended > conducted) {
                document.getElementById(`attended-error-${rowIndex}`).textContent = 'Attended classes cannot exceed conducted classes';
                isValid = false;
            }

            // Validate target percentage
            if (isNaN(target) || target < 0 || target > 100) {
                document.getElementById(`target-error-${rowIndex}`).textContent = 'Target percentage must be between 0 and 100';
                isValid = false;
            }

            const currentPercentageElement = document.getElementById(`current-percentage-${rowIndex}`);
            const extraClassesElement = document.getElementById(`extra-classes-${rowIndex}`);

            if (!isValid) {
                currentPercentageElement.textContent = '-';
                extraClassesElement.textContent = '-';
                return;
            }

            // Calculate current percentage
            const currentPercentage = conducted > 0 ? (attended / conducted) * 100 : 0;
            currentPercentageElement.textContent = `${currentPercentage.toFixed(1)}%`;

            // Calculate extra classes needed
            if (currentPercentage >= target) {
                extraClassesElement.innerHTML = '<span class="target-achieved">Target Achieved ✅</span>';
            } else {
                // Formula: x = ((P/100 * T) - A) / (1 - (P/100))
                // Where: P = target percentage, T = total classes (conducted + extra), A = attended classes, x = extra classes needed
                const P = target;
                const T = conducted;  // Current total classes conducted
                const A = attended;   // Current classes attended
                
                if (P >= 100) {
                    extraClassesElement.innerHTML = '<span class="extra-needed">Impossible (100% target)</span>';
                } else {

                    const extraClasses = Math.ceil(((P / 100) * T - A) / (1 - (P / 100)));
                    
                    if (extraClasses <= 0) {
                        extraClassesElement.innerHTML = '<span class="target-achieved">Target Achieved ✅</span>';
                    } else {
                        extraClassesElement.innerHTML = `<span class="extra-needed">${extraClasses} classes</span>`;
                    }
                }
            }
        }

        // Initialize page when loaded
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>